<%- include('./partials/header') %>

<!-- Enhanced Styles (reuse from cart page) -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
  * { font-family: 'Inter', sans-serif; }

  .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .purchase-item {
      transform: translateY(0);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  .purchase-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  }

  .page-enter {
      animation: fadeInUp 0.6s ease-out;
  }

  @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
  }

  .price-highlight {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: bold;
  }

  .empty-history {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      animation: fadeIn 0.8s ease-out;
      text-align: center;
      padding: 6rem 2rem;
      border-radius: 1rem;
  }

  @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
  }
</style>

<!-- Hero Section -->
<div class="gradient-bg text-white py-12">
    <div class="container mx-auto px-4 text-center page-enter">
        <i class="fas fa-user text-4xl"></i>
        <h1 class="text-4xl font-bold mt-2">My Account</h1>
        <h2 class="text-white/100 text-2xl mt-2">Welcome, <%= user.fullname %>.</h2>
    </div>
</div>
<h2 class="px-4 text-black/80 mt-2" >
  Review your purchase history below.
</h2>
<div class="min-h-screen bg-gray-50 py-8">
    <div class="container mx-auto px-4">
        <% if (purchases.length > 0) { %>
            <div class="grid md:grid-cols-2 gap-6 page-enter">
                <% purchases.forEach(function(purchase, index) { %>
                    <div class="glass-effect rounded-xl shadow-xl p-6 purchase-item" style="animation-delay:s;">
                        <div class="flex items-center space-x-4">
                            <% if (purchase.productId && purchase.productId.image) { %>
                                <img src="data:image/jpeg;base64,<%= purchase.productId.image.toString('base64') %>" 
                                     class="h-24 w-24 rounded-xl object-cover shadow-lg" alt="<%= purchase.productId.name %>">
                            <% } else { %>
                                <div class="h-24 w-24 rounded-xl bg-gray-200 flex items-center justify-center text-gray-400">
                                    <i class="fas fa-box-open text-2xl"></i>
                                </div>
                            <% } %>
                            <div class="flex-1">
                                <h3 class="font-semibold text-lg text-gray-800"><%= purchase.productId ? purchase.productId.name : "Product deleted" %></h3>
                                <p class="text-sm text-gray-500 mt-1">
                                    Quantity: <%= purchase.quantity %>
                                </p>
                                <p class="text-sm text-gray-500">
                                    Purchased on: <%= purchase.purchaseDate.toDateString() %>
                                </p>
                            </div>
                            <div class="text-right">
                                <div class="text-xl font-bold price-highlight">
                                    â‚¹<%= purchase.totalPrice %>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <div class="empty-history page-enter">
                <i class="fas fa-history text-6xl text-gray-400 mb-4"></i>
                <h2 class="text-3xl font-bold text-gray-700 mb-2">No Purchases Yet</h2>
                <p class="text-gray-500 mb-4">Looks like you haven't bought any items yet.</p>
                <a href="/shop" 
                   class="inline-flex items-center action-btn bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-8 py-4 rounded-xl hover:from-indigo-700 hover:to-purple-700 font-bold text-lg shadow-lg">
                   <i class="fas fa-store mr-2"></i>Start Shopping
                </a>
            </div>
        <% } %>
    </div>
</div>

<script>
    // Scroll animation for purchase items
    const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -50px 0px' };
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    document.querySelectorAll('.purchase-item').forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(30px)';
        item.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
        observer.observe(item);
    });
</script>

<%- include('./partials/footer') %>
