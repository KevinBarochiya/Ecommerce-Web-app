<%- include('./partials/header') %>
<% if (REJ.length > 0) { %>
    <div class="absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 p-3 rounded-md bg-blue-500" id="flash-message">
        <span class="inline-block mt-1 mb-1 text-white">
            <%= REJ %>
        </span>
    </div>
<% } %>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const flashMessage = document.getElementById("flash-message");
        if (flashMessage) {
            setTimeout(() => {
                flashMessage.style.transition = "opacity 0.5s ease";
                flashMessage.style.opacity = "0";
                setTimeout(() => flashMessage.remove(), 500); // Remove after fade-out
            }, 1500); // Display for 1.5 seconds
        }
    });
</script>

<div class="container mx-auto mt-10 px-5">
    <h1 class="text-2xl font-bold mb-5">Your Cart</h1>
    <% if (user.cart.length > 0) { %>
        <table class="w-full border-collapse border border-gray-300">
            <thead>
                <tr class="bg-gray-100">
                    <th class="border border-gray-300 px-4 py-2 text-left">Product</th>
                    <th class="border border-gray-300 px-4 py-2 text-center">Quantity</th>
                    <th class="border border-gray-300 px-4 py-2 text-center">Price</th>
                    <th class="border border-gray-300 px-4 py-2 text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                <% user.cart.forEach(function(item) { %>
                <tr>
                    <td class="border border-gray-300 px-4 py-2 flex items-center gap-4">
                        <img class="h-20 w-20 rounded-md" src="data:image/jpeg;base64,<%= item.image.toString('base64') %>" alt="">
                        <div>
                            <h3 class="font-semibold text-lg"><%= item.name %></h3>
                        </div>
                    </td>
                    <td class="border border-gray-300 px-4 py-2 text-center">
                        <div class="flex items-center justify-center gap-2">
                            <a href="/cart/decrement/<%= item._id %>" class="w-7 h-7 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300">
                                <i class="ri-subtract-line"></i>
                            </a>
                            <span class="px-4 py-1 border rounded-md">1</span>
                            <a href="/cart/increment/<%= item._id %>" class="w-7 h-7 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300">
                                <i class="ri-add-line"></i>
                            </a>
                        </div>
                    </td>
                    <td class="border border-gray-300 px-4 py-2 text-center">
                        ₹ <%= Number(item.price) + 20 - Number(item.discount) %>
                    </td>
                    <td class="border border-gray-300 px-4 py-2 text-center">
                        <a href="/cart/remove/<%= item._id %>" class="text-red-500 hover:underline">Remove</a>
                        <br>
                        <form action="/buy/<%= item._id %>" method="POST">
                            <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600">
                                Buy
                            </button>
                        </form>
                        
                    </td>
                </tr>
                <% }) %>
            </tbody>
        </table>

        <!-- Buy All Button -->
        <div class="mt-5 flex justify-between items-center">
            <h2 class="text-xl font-semibold">Total: ₹ 
                <%= user.cart.reduce((total, item) => total + Number(item.price) + 20 - Number(item.discount), 0) %>
            </h2>
            <a href="/buy-all" class="bg-blue-500 text-white px-5 py-2 rounded-md hover:bg-blue-600">Buy All</a>
        </div>
        <div>
            <p>Only cash on delievery is available</p>
        </div>
    <% } else { %>
        <p class="text-gray-600">Your cart is empty.</p>
    <% } %>
</div>
<%- include('./partials/footer') %>
